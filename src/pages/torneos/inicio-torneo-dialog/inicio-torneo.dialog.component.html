<!-- =========================
     CONTENIDO PRINCIPAL (categoria + Results / Sets)
     ========================= -->
<mat-dialog-content class="contenido-modal">

  <!-- ===== SPINNER DE CARGA ===== -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-container">
      <mat-spinner diameter="60"></mat-spinner>
      <p class="loading-text">Cargando bracket del torneo...</p>
    </div>
  </div>

  <!-- ===== CONTROLES SUPERIORES ===== -->
  <div class="controls-section minimal-controls" *ngIf="!loading">
    <mat-form-field appearance="outline" class="category-select">
      <mat-label>Seleccionar Categoría</mat-label>
      <mat-select [(value)]="selectedCategory" (selectionChange)="filtrarCategoria()">
        <mat-option *ngFor="let cat of categories" [value]="cat.category_name">
          <div class="category-option">
            <span class="category-name">{{ cat.category_name }}</span>
            <span class="category-level">Nivel {{ cat.level }}</span>
          </div>
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Botón para toggle del sidebar -->
    <button mat-stroked-button (click)="toggleResultsSidebar()" class="toggle-sidebar-btn">
      <mat-icon>{{ showResultsSidebar ? 'chevron_left' : 'chevron_right' }}</mat-icon>
      {{ showResultsSidebar ? 'Ocultar' : 'Mostrar' }} Grupos
    </button>
  </div>

  <div class="results-view" *ngIf="!loading">
    <div class="results-and-bracket">

      <!-- SIDEBAR IZQUIERDO: Resultados (SETS) COLAPSABLE -->
      <div class="results-sidebar" [class.collapsed]="!showResultsSidebar">
        <div class="sidebar-content">
          <div class="sidebar-header">
            <h3>Grupos</h3>
          </div>

          <div class="sidebar-body">
            <ng-container *ngFor="let group of resultsGroupedByGroup">

              <h3 class="group-title">{{ group.groupName }}</h3>

              <table class="ranking-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Equipo</th>
                    <th>G</th>
                    <th>P</th>
                    <th>SET AVE</th>
                    <th>GAME AVE</th>
                  </tr>
                </thead>

                <tbody>
                  <tr *ngFor="let match of group.matches; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ match.jugador1[0].name }} / {{ match.jugador2[0].name }}</td>
                    <td>{{ match.wins ?? 0 }}</td>
                    <td>{{ match.losses ?? 0 }}</td>
                  </tr>
                </tbody>
              </table>

            </ng-container>
          </div>

        </div>
      </div>

      <!-- CONTENIDO PRINCIPAL: Bracket Eliminatorias -->
      <div class="main-content" [class.full-width]="!showResultsSidebar">
        <div class="bracket-column" *ngIf="results.length > 0; else noCategorySelected">
          <div class="bracket-header">
            <h3>Bracket de Eliminatorias - {{ selectedCategory }}</h3>
            <!-- Botón flotante para mostrar sidebar cuando está colapsado -->
            <!-- <button *ngIf="!showResultsSidebar" mat-fab (click)="toggleResultsSidebar()" 
                    class="floating-sidebar-toggle" color="primary">
              <mat-icon>menu</mat-icon>
            </button> -->
          </div>
          <div #bracketContainerSets class="bracket-container-sets"
            style="width: 100%; height: 600px; background: #f8fafc;" aria-label="Bracket eliminatorias">
            <!-- El contenido se generará por D3 -->
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Mensaje de no results -->
  <ng-template #noResults>
    <div class="no-results-container" *ngIf="!loading">
      <div class="empty-state">
        <mat-icon class="empty-icon">sports_tennis</mat-icon>
        <p class="empty-message">Selecciona una categoría para ver los resultados</p>
      </div>
    </div>
  </ng-template>

  <!-- Mensaje cuando no hay categoría seleccionada -->
  <ng-template #noCategorySelected>
    <div class="main-content full-width" *ngIf="!loading">
      <div class="bracket-column placeholder">
        <div class="no-results-container">
          <div class="empty-state">
            <mat-icon class="empty-icon">category</mat-icon>
            <p class="empty-message">Selecciona una categoría para ver el bracket</p>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

</mat-dialog-content>

<!-- =========================
     BOTONES FINALES (mínimos)
     ========================= -->
<!-- <mat-dialog-actions align="end" class="dialog-actions" *ngIf="!loading">
  <button mat-stroked-button (click)="cerrar()" class="action-btn">Cerrar</button>
</mat-dialog-actions> -->