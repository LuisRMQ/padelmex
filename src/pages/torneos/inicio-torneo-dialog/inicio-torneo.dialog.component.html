<!-- =========================
     CONTENIDO PRINCIPAL (categoria + Results / Sets)
     ========================= -->
<mat-dialog-content class="contenido-modal">

  <!-- ===== SPINNER DE CARGA ===== -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-container">
      <mat-spinner diameter="60"></mat-spinner>
      <p class="loading-text">Cargando bracket del torneo...</p>
    </div>
  </div>

  <!-- ===== CONTROLES SUPERIORES ===== -->
  <div class="controls-section minimal-controls" *ngIf="!loading">
    <mat-form-field appearance="outline" class="category-select">
      <mat-label>Seleccionar Categoría</mat-label>
      <mat-select [(value)]="selectedCategory" (selectionChange)="filtrarCategoria()">
        <mat-option *ngFor="let cat of categories" [value]="cat.category_name">
          <div class="category-option">
            <span class="category-name">{{ cat.category_name }}</span>
            <span class="category-level">Nivel {{ cat.level }}</span>
          </div>
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Botón para toggle del sidebar -->
    <button mat-stroked-button (click)="toggleResultsSidebar()" class="toggle-sidebar-btn">
      <mat-icon>{{ showResultsSidebar ? 'chevron_left' : 'chevron_right' }}</mat-icon>
      {{ showResultsSidebar ? 'Ocultar' : 'Mostrar' }} Grupos
    </button>
  </div>

  <div class="results-view" *ngIf="!loading">
    <div class="results-and-bracket">

      <!-- SIDEBAR IZQUIERDO: Resultados (SETS) COLAPSABLE -->
      <div class="results-sidebar" [class.collapsed]="!showResultsSidebar">
        <div class="sidebar-content">
          <div class="sidebar-header">
            <h3>Grupos - {{ selectedCategory }}</h3>
          </div>

          <div class="sidebar-body">
            <ng-container *ngFor="let group of groupStandings">
              <div class="group-section">
                <h4 class="group-title">{{ group.groupName }}</h4>

                <table class="ranking-table">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Equipo</th>
                      <th>PJ</th>
                      <th>G</th>
                      <th>P</th>
                      <th>+/- Sets</th>
                      <th>+/- Games</th>
                      <th>Pts</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let team of group.standings">
                      <td class="position-cell">
                        <span class="position-badge" [class.top-badge]="team.position <= 2">
                          {{ team.position }}
                        </span>
                      </td>
                      <td class="team-name" [innerHTML]="team.teamName.replace('/', '<br/><span class=\'separator\'>/</span> ')"></td>
                      <td>{{ team.gamesPlayed }}</td>
                      <td>{{ team.gamesWon }}</td>
                      <td>{{ team.gamesLost }}</td>
                      <td [class.positive]="team.setDiff > 0" [class.negative]="team.setDiff < 0">
                        {{ team.setDiff > 0 ? '+' : '' }}{{ team.setDiff }}
                      </td>
                      <td [class.positive]="team.gameDiff > 0" [class.negative]="team.gameDiff < 0">
                        {{ team.gameDiff > 0 ? '+' : '' }}{{ team.gameDiff }}
                      </td>
                      <td class="points-cell">{{ team.points }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </ng-container>

            <!-- Mensaje si no hay grupos -->
            <div *ngIf="groupStandings.length === 0" class="no-groups-message">
              <mat-icon>group</mat-icon>
              <p>No hay grupos disponibles</p>
            </div>
          </div>
        </div>
      </div>

      <!-- CONTENIDO PRINCIPAL: Bracket Eliminatorias -->
      <div class="main-content" [class.full-width]="!showResultsSidebar">
        <div class="bracket-column" *ngIf="filteredBracket.length > 0; else noCategorySelected">
          <div class="bracket-header">
            <h3>Bracket de Eliminatorias - {{ selectedCategory }}</h3>
          </div>
          <div #bracketContainerSets class="bracket-container-sets"
            style="width: 100%; height: 600px; overflow: auto; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px;"
            aria-label="Bracket eliminatorias">
            <!-- El contenido se generará por D3 -->
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Mensaje de no results -->
  <ng-template #noResults>
    <div class="no-results-container" *ngIf="!loading">
      <div class="empty-state">
        <mat-icon class="empty-icon">sports_tennis</mat-icon>
        <p class="empty-message">Selecciona una categoría para ver los resultados</p>
      </div>
    </div>
  </ng-template>

  <!-- Mensaje cuando no hay categoría seleccionada -->
  <ng-template #noCategorySelected>
    <div class="main-content full-width" *ngIf="!loading">
      <div class="bracket-column placeholder">
        <div class="no-results-container">
          <div class="empty-state">
            <mat-icon class="empty-icon">category</mat-icon>
            <p class="empty-message">Selecciona una categoría para ver el bracket</p>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

</mat-dialog-content>