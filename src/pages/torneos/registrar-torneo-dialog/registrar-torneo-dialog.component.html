<div class="modern-container">
  <mat-card [formGroup]="form" class="modern-card">
    <!-- Header -->
    <mat-card-header class="modern-header">
      <div class="header-content">
        <div class="icon-container">
          <mat-icon class="header-icon">emoji_events</mat-icon>
        </div>
        <div>
          <mat-card-title class="modern-title">Registrar Torneo</mat-card-title>
          <mat-card-subtitle class="modern-subtitle">Complete la información para crear un nuevo
            torneo</mat-card-subtitle>
        </div>
      </div>
    </mat-card-header>

    <!-- Contenido del formulario -->
    <mat-card-content class="modern-content">
      <div class="form-grid">
        <!-- Nombre -->
        <mat-form-field appearance="fill" class="modern-field">
          <mat-label>Nombre del torneo</mat-label>
          <input matInput formControlName="name" placeholder="Ej: Torneo Anual 2025">
          <mat-icon matPrefix>emoji_events</mat-icon>
        </mat-form-field>

        <!-- Descripción -->
        <mat-form-field appearance="fill" class="modern-field full-width">
          <mat-label>Descripción</mat-label>
          <textarea matInput formControlName="description" placeholder="Descripción del torneo"></textarea>
          <mat-icon matPrefix>description</mat-icon>
        </mat-form-field>

        <!-- Club -->
        <mat-form-field appearance="fill" class="modern-field full-width">
          <mat-label>Club</mat-label>
          <mat-select formControlName="club_id">
            <mat-option *ngFor="let club of clubsDisponibles" [value]="club.id">
              {{ club.name }}
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>location_city</mat-icon>
        </mat-form-field>

<div formArrayName="courts" class="modern-field full-width">
  <label>Canchas disponibles</label>
  <div *ngFor="let court of courtsDisponibles; let i = index">
    <mat-checkbox [value]="court.id" (change)="onCourtChange($event, court.id)">
      {{ court.name }}
    </mat-checkbox>
  </div>
</div>


        <!-- Fecha inicio -->
        <mat-form-field appearance="fill" class="modern-field">
          <mat-label>Fecha inicio</mat-label>
          <input matInput [matDatepicker]="pickerInicio" formControlName="start_date">
          <mat-datepicker-toggle matSuffix [for]="pickerInicio"></mat-datepicker-toggle>
          <mat-datepicker #pickerInicio></mat-datepicker>
          <mat-icon matPrefix>today</mat-icon>
        </mat-form-field>

        <!-- Fecha fin -->
        <mat-form-field appearance="fill" class="modern-field">
          <mat-label>Fecha fin</mat-label>
          <input matInput [matDatepicker]="pickerFin" formControlName="end_date">
          <mat-datepicker-toggle matSuffix [for]="pickerFin"></mat-datepicker-toggle>
          <mat-datepicker #pickerFin></mat-datepicker>
          <mat-icon matPrefix>event</mat-icon>
        </mat-form-field>

        <!-- Límite de inscripción -->
        <mat-form-field appearance="fill" class="modern-field">
          <mat-label>Fecha límite de inscripción</mat-label>
          <input matInput [matDatepicker]="pickerRegistro" formControlName="registration_deadline">
          <mat-datepicker-toggle matSuffix [for]="pickerRegistro"></mat-datepicker-toggle>
          <mat-datepicker #pickerRegistro></mat-datepicker>
          <mat-icon matPrefix>schedule</mat-icon>
        </mat-form-field>


   <mat-form-field appearance="fill" class="modern-field">
  <mat-label>Hora de juego</mat-label>
  <input matInput type="time" formControlName="time_play">
  <mat-icon matSuffix>schedule</mat-icon>
</mat-form-field>

        <!-- Costo -->
        <mat-form-field appearance="fill" class="modern-field">
          <mat-label>Costo de inscripción</mat-label>
          <input matInput type="number" min="0" formControlName="registration_fee">
          <mat-icon matPrefix>attach_money</mat-icon>
        </mat-form-field>

        <!-- Selección de categorías -->
        <mat-form-field appearance="fill" class="modern-field full-width">
          <mat-label>Categorías</mat-label>
          <mat-select (selectionChange)="onCategorySelected($event.value)" multiple>
            <mat-option *ngFor="let cat of categoriasDisponibles" [value]="cat">
              {{ cat.category }}
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>category</mat-icon>
        </mat-form-field>

        <!-- Inputs de max_participants por categoría -->
        <div formArrayName="categories" *ngFor="let catCtrl of categories.controls; let i = index">
          <div [formGroupName]="i">
            <mat-form-field appearance="fill" class="modern-field full-width">
              <mat-label>{{ getCategoryFormGroup(catCtrl).get('category')?.value }}</mat-label>
              <input matInput type="number" min="1" formControlName="max_participants" placeholder="Máx. participantes">
              <mat-icon matPrefix>groups</mat-icon>
            </mat-form-field>
          </div>
        </div>

        <!-- Máx. participantes total
        <mat-form-field appearance="fill" class="modern-field">
          <mat-label>Máx. participantes totales</mat-label>
          <input matInput type="number" min="2" formControlName="max_participants">
          <mat-icon matPrefix>groups</mat-icon>
        </mat-form-field> -->

        <!-- Premios -->
        <mat-form-field appearance="fill" class="modern-field full-width">
          <mat-label>Premios</mat-label>
          <mat-select formControlName="prizes" multiple>
            <mat-option *ngFor="let premio of premiosDisponibles" [value]="premio">
              {{ premio }}
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>card_giftcard</mat-icon>
        </mat-form-field>

        <!-- Reglamento -->
        <mat-form-field appearance="fill" class="modern-field full-width">
          <mat-label>Reglamento</mat-label>
          <textarea matInput formControlName="rules"></textarea>
          <mat-icon matPrefix>rule</mat-icon>
        </mat-form-field>
      </div>

      <!-- Logo -->
      <div class="section">
        <h3 class="section-title">
          <mat-icon class="section-icon">photo_camera</mat-icon>
          Logo del Torneo
        </h3>
        <div class="photo-section">
          <div class="upload-area" (click)="fileInput.click()">
            <input type="file" hidden (change)="onFileSelected($event)" #fileInput accept="image/*">
            <div class="upload-content">
              <mat-icon class="upload-icon">cloud_upload</mat-icon>
              <p>Haga clic para subir un logo</p>
              <span class="upload-hint">Formatos: JPG, PNG (Máx. 5MB)</span>
            </div>
          </div>

          <div class="preview-container">
            <div class="preview-card" [class.has-image]="logoPreview">
              <ng-container *ngIf="logoPreview; else noLogo">
                <img [src]="logoPreview" alt="Vista previa" class="preview-image">
                <button mat-icon-button class="remove-btn" (click)="removePhoto()">
                  <mat-icon>close</mat-icon>
                </button>
              </ng-container>
              <ng-template #noLogo>
                <div class="no-image">
                  <mat-icon>photo</mat-icon>
                  <span>Sin logo</span>
                </div>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>

    <!-- Acciones -->
    <mat-card-actions class="modern-actions">
      <button mat-button class="cancel-btn" (click)="onCancel()">
        <mat-icon>close</mat-icon> Cancelar
      </button>
      <button mat-raised-button class="save-btn" (click)="guardar()">
        <mat-icon>save</mat-icon> Guardar Torneo
      </button>
    </mat-card-actions>
  </mat-card>
</div>