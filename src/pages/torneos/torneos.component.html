<div class="header">
  <h1>Torneos</h1>
  <button mat-raised-button color="primary" (click)="abrirModalRegistrarTorneo()" class="btn-registrar">
    <mat-icon>add</mat-icon> Registrar Torneo
  </button>
</div>
<mat-divider style="margin-bottom: 24px; opacity: 0.12;"></mat-divider>

<div class="torneos-container">
  <div class="torneo-item" *ngFor="let torneo of torneos">
    <mat-card class="torneo-card">
      <!-- Badge de estado -->
      <div class="card-badge" [class.activo]="torneo.status === 'open' || torneo.status === 'in_progress'"
        [class.finalizado]="torneo.status === 'completed' || torneo.status === 'closed' || torneo.status === 'cancelled'"
        [class.borrador]="torneo.status === 'draft'" [matMenuTriggerFor]="statusMenu"
        (click)="$event.stopPropagation()">
        {{ getEstadoTorneo(torneo.status) }}
      </div>

      <mat-menu #statusMenu="matMenu">
        <button mat-menu-item *ngFor="let estado of estadosDisponibles" (click)="cambiarEstado(torneo, estado)">
          {{ getEstadoTorneo(estado) }}
        </button>
      </mat-menu>

      <mat-card-header class="torneo-card-header">
        <div class="title-container">
          <mat-card-title>{{ torneo.name }}</mat-card-title>
          <mat-card-subtitle>
            <mat-icon>calendar_today</mat-icon>
            {{ torneo.start_date | date:'dd MMM yyyy' }} - {{ torneo.end_date | date:'dd MMM yyyy' }}
          </mat-card-subtitle>
        </div>
      </mat-card-header>

      <img mat-card-image [src]="torneo.photo || 'assets/default-torneo.jpg'" alt="{{ torneo.name }}"
        (error)="onImageError($event)">

      <mat-card-content>
        <p class="torneo-descripcion">{{ torneo.description || 'Sin descripción' }}</p>

        <div class="torneo-info">
          <div class="info-item">
            <mat-icon>groups</mat-icon>
            <span>{{ torneo.current_participants || 0 }}/{{ torneo.max_participants }} participantes</span>
          </div>

          <div class="info-item">
            <mat-icon>event_available</mat-icon>
            <span>Inscripción hasta: {{ torneo.registration_deadline | date:'dd MMM yyyy' }}</span>
          </div>

  <div class="info-item">
    <mat-icon>payments</mat-icon>
    <span>Cuota: {{ +torneo.registration_fee | currency:'':'symbol':'1.2-2':'en-US' }}</span>
  </div>
          <div class="info-item" *ngIf="torneo.prizes">
            <mat-icon>emoji_events</mat-icon>
            <span>{{ torneo.prizes.length ? torneo.prizes.join(', ') : 'Sin premio' }}</span>
          </div>

          <div class="info-item" *ngIf="torneo.club_name">
            <mat-icon>location_on</mat-icon>
            <span>{{ torneo.club_name }}</span>
          </div>
        </div>

        <div class="torneo-rules" *ngIf="torneo.rules">
          <h4>Reglas:</h4>
          <p>{{ torneo.rules }}</p>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <!-- <button mat-icon-button (click)="$event.stopPropagation(); verDetalles(torneo)">
          <mat-icon>user</mat-icon>
        </button> -->
        <button mat-icon-button color="danger" (click)="$event.stopPropagation(); verParticipantes(torneo.id)">
          <mat-icon>sports_handball</mat-icon>
        </button>
        <button mat-icon-button color="primary" (click)="$event.stopPropagation(); verDetalles(torneo)">
          <mat-icon>visibility</mat-icon>
        </button>
        <button mat-icon-button color="accent" (click)="$event.stopPropagation(); editarTorneo(torneo)">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button color="danger" (click)="$event.stopPropagation(); eliminarTorneo(torneo)">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>